{{ component "layout" . }}
{{ component "layout_user" . }}

{{ component "block" (props .
    "Icon" "user"
    "Name" (printf "password for %s" .SelectedUser.Name)
) }}
    <div class="flex flex-col gap-2 items-center">
        <p class="text-gray-500">Current password:</p>
        {{ if .Props.ShowPlainText }}
            <!-- No-JS fallback: show password in plain text -->
            <div class="flex gap-2 items-center">
                <div class="font-mono text-lg bg-gray-100 p-3 rounded border select-all">{{ .SelectedUser.Password }}</div>
                <a href="{{ printf "/admin/reveal_password?user=%s" .SelectedUser.Name | path }}" class="px-3 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Hide</a>
            </div>
            <p class="text-sm text-gray-600">Password is shown in plain text. You can select and copy it manually.</p>
        {{ else }}
            <!-- Default: masked password with JS copy functionality -->
            <div class="flex gap-2 items-center">
                <input type="password" id="password-field" value="{{ .SelectedUser.Password }}" readonly class="font-mono text-lg bg-gray-100 p-3 rounded border">
                <button id="copy-btn" class="px-3 py-2 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="copyPassword()">Copy</button>
            </div>
            <!-- No-JS fallback link -->
            <noscript>
                <a href="{{ printf "/admin/reveal_password?user=%s&show=true" .SelectedUser.Name | path }}" class="text-blue-500 hover:text-blue-700 underline">Show password in plain text (no JavaScript required)</a>
            </noscript>
            <p class="text-sm text-gray-600">This password can be used for Subsonic API access.</p>
        {{ end }}
    </div>
    
    <script>
        function copyPassword() {
            const passwordField = document.getElementById('password-field');
            passwordField.select();
            passwordField.setSelectionRange(0, 99999); // For mobile devices
            
            navigator.clipboard.writeText(passwordField.value).then(function() {
                const btn = document.getElementById('copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                btn.classList.add('bg-green-500');
                setTimeout(function() {
                    btn.textContent = originalText;
                    btn.classList.remove('bg-green-500');
                    btn.classList.add('bg-blue-500', 'hover:bg-blue-600');
                }, 2000);
            }).catch(function(err) {
                console.error('Failed to copy password: ', err);
                alert('Failed to copy password to clipboard');
            });
        }
    </script>
{{ end }}

{{ end }}
{{ end }}